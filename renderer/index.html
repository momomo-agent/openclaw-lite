<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paw</title>
  <script src="lib/marked.js"></script>
  <script src="lib/highlight.min.js"></script>
  <link rel="stylesheet" href="lib/highlight-github-dark.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Setup screen -->
  <div id="setupScreen" class="screen">
    <div class="setup-container">
      <h1>ğŸ¾ Paw</h1>
      <p class="subtitle">Portable local AI assistant</p>

      <div class="setup-actions">
        <button class="setup-btn" onclick="createNew()">
          <span class="setup-icon">+</span>
          <span class="setup-label">Create New</span>
          <span class="setup-hint">Set up a new Claw directory</span>
        </button>
        <button class="setup-btn" onclick="openExisting()">
          <span class="setup-icon">ğŸ“‚</span>
          <span class="setup-label">Open Existing</span>
          <span class="setup-hint">Use an existing directory</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Chat screen -->
  <div id="chatScreen" class="screen" style="display:none">
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <span>Sessions</span>
        <button class="icon-btn" onclick="newSession()">+</button>
      </div>
      <div id="sessionList" class="session-list"></div>
    </div>
    <div class="chat-main">
      <div class="chat-header">
        <span id="sessionTitle">New Chat</span>
        <div class="header-actions">
          <button class="icon-btn" onclick="toggleMembers()">ğŸ‘¥</button>
          <button class="icon-btn" onclick="exportChat()">ğŸ“¥</button>
          <button class="icon-btn" onclick="openSettings()">âš™ï¸</button>
        </div>
      </div>
      <div id="messages" class="messages"></div>
      <div id="attachPreview" style="display:none"></div>
      <div class="input-bar">
        <button class="icon-btn attach-btn" onclick="document.getElementById('fileInput').click()" title="Attach file">ğŸ“</button>
        <input type="file" id="fileInput" style="display:none" multiple onchange="handleFiles(this.files)">
        <textarea id="input" placeholder="Ask anything... (@name to target)" rows="1"></textarea>
        <button id="sendBtn" onclick="send()">â†‘</button>
      </div>
    </div>
  </div>

  <!-- Settings overlay -->
  <div id="settingsOverlay" class="overlay" style="display:none" onclick="if(event.target===this)closeSettings()">
    <div class="settings-panel settings-wide">
      <div class="settings-header">
        <span>Settings</span>
        <button class="icon-btn" onclick="closeSettings()">âœ•</button>
      </div>
      <div class="settings-body settings-tabbed">
        <div class="settings-tabs">
          <button class="settings-tab active" data-tab="general" onclick="switchSettingsTab('general')">General</button>
          <button class="settings-tab" data-tab="model" onclick="switchSettingsTab('model')">Model</button>
          <button class="settings-tab" data-tab="tools" onclick="switchSettingsTab('tools')">Tools</button>
          <button class="settings-tab" data-tab="heartbeat" onclick="switchSettingsTab('heartbeat')">Heartbeat</button>
        </div>
        <div class="settings-content">
          <!-- General tab -->
          <div class="settings-tab-content active" id="tab-general">
            <label>Provider</label>
            <select id="cfgProvider">
              <option value="anthropic">Anthropic</option>
              <option value="openai">OpenAI</option>
            </select>
            <label>API Key</label>
            <input id="cfgApiKey" type="password" placeholder="sk-...">
            <label>Base URL <span class="hint">(optional)</span></label>
            <input id="cfgBaseUrl" type="text" placeholder="https://api.anthropic.com">
            <button class="secondary-btn" onclick="window.api.openClawDir()">Open Workspace in Finder</button>
          </div>
          <!-- Model tab -->
          <div class="settings-tab-content" id="tab-model">
            <label>Model</label>
            <input id="cfgModel" type="text" placeholder="claude-sonnet-4-20250514">
            <p class="hint" style="margin:8px 0">Leave empty to use provider default.</p>
          </div>
          <!-- Tools tab -->
          <div class="settings-tab-content" id="tab-tools">
            <label>Tavily API Key <span class="hint">(for web search)</span></label>
            <input id="cfgTavilyKey" type="password" placeholder="tvly-...">
            <label style="margin-top:12px">Exec Approval</label>
            <label class="toggle-label"><input type="checkbox" id="cfgExecApproval" checked> Require approval for dangerous commands</label>
          </div>
          <!-- Heartbeat tab -->
          <div class="settings-tab-content" id="tab-heartbeat">
            <label class="toggle-label"><input type="checkbox" id="cfgHeartbeat"> Enable Heartbeat</label>
            <p class="hint" style="margin:4px 0 12px">Agent checks in periodically to do background work.</p>
            <label>Interval (minutes)</label>
            <input id="cfgHeartbeatInterval" type="number" value="30" min="1" max="1440" style="width:100px">
          </div>
        </div>
        <div class="settings-footer">
          <button class="primary-btn" onclick="saveSettings()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Members panel -->
  <div id="membersOverlay" class="overlay" style="display:none" onclick="if(event.target===this)closeMembers()">
    <div class="settings-panel">
      <div class="settings-header">
        <span>Members</span>
        <button class="icon-btn" onclick="closeMembers()">âœ•</button>
      </div>
      <div class="settings-body">
        <div id="memberList"></div>
        <div class="member-add">
          <select id="addAgentSelect"></select>
          <button onclick="addAgentToSession()">Add</button>
        </div>
        <hr style="border-color:#1a1a1a;margin:8px 0">
        <button class="primary-btn" onclick="openAgentManager()">Manage Agents</button>
      </div>
    </div>
  </div>

  <!-- Agent manager -->
  <div id="agentManagerOverlay" class="overlay" style="display:none" onclick="if(event.target===this)closeAgentManager()">
    <div class="settings-panel settings-wide">
      <div class="settings-header">
        <span>Agents</span>
        <button class="icon-btn" onclick="closeAgentManager()">âœ•</button>
      </div>
      <div class="settings-body">
        <div id="agentList" class="agent-grid"></div>
        <hr style="border-color:#1a1a1a;margin:12px 0">
        <details class="agent-create-section">
          <summary>Create New Agent</summary>
          <div style="margin-top:8px">
            <label>Name</label>
            <input id="newAgentName" type="text" placeholder="Agent name">
            <label>Soul (system prompt)</label>
            <textarea id="newAgentSoul" rows="4" class="agent-soul-input"></textarea>
            <label>Model <span class="hint">(optional override)</span></label>
            <input id="newAgentModel" type="text" placeholder="claude-sonnet-4-20250514">
            <button class="primary-btn" style="margin-top:8px" onclick="createNewAgent()">Create Agent</button>
          </div>
        </details>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
